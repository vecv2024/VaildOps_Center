<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <title>Navbar</title>
  <style>
    /* General Reset */
    body,
    html {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Navbar Styles */
.navbar {
    background-color: #d9241d;
    display: flex;
    align-items: center;
    padding: 10px 20px;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  
  .navbar img {
    height: 40px; /* Adjust height of the logo */
    margin-right: 15px; /* Space between the logo and Home */
  }
  
  .navbar a {
    color: white;
    padding: 8px 15px;
    text-decoration: none;
    font-size: 16px;
    display: inline-block;
    position: relative;
  }
  
  .navbar a:hover {
    background-color: transparent; /* No background change on hover */
  }
  
  .dropdown {
    position: relative;
    display: inline-block;
  }
  
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f1f1f1;
    min-width: 160px;
    z-index: 1;
    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
    margin-top: 10px;
  }
  
  .dropdown.show .dropdown-content {
    display: block;
  }
  
  .dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }
  
  .dropdown-content a:hover {
    background-color: #ddd;
  }
  
  .search-container {
    display: inline-block;
    position: relative;
  }
  
  .search-container input[type="text"] {
    padding: 6px 10px;
    font-size: 16px;
    border: none;
    border-radius: 4px;
    width: 200px;
  }
  
  .search-container button {
    position: absolute;
    right: 0;
    top: 0;
    background-color: #fff;
    border: none;
    padding: 8px;
    cursor: pointer;
  }
  
  .search-container button i {
    color: red;
  }
  
  .profile-container {
    margin-left: auto;
    padding-left: 20px;
  }
  
    /*----------------Table------------------*/


    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      font-size: 12px;

      border-radius: 10px;
      overflow: hidden;
      /* Ensures corners of content stay rounded */

      /* Add shadow */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1),
        0 1px 3px rgba(0, 0, 0, 0.06);

    }

    th,
    td {
      border: 1px solid #dad5d5;
      padding: 10px;
      text-align: left;
    }

    th {
      background: #bfbfbf;
      font-size: 14px;
    }

    tr {
      background: #fff;
    }

    .highlight {
      /* background: linear-gradient(to bottom, #A3E4D7, #76D7C4); */
      background: #e2ff8c;
    }

    .protus-tracking {
      text-align: center !important;
      background: radial-gradient(circle, #e9e8e8 0%, rgba(233, 232, 232, 0) 70%);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin: 10px;
    }

    .footer {
                background-color: #dedddd;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px 20px;
                position: relative;
                bottom: 0;
                width: 100%;
                box-sizing: border-box;
                border-top: 1px solid #ccc;
                z-index: 1000;
            }
            
            .footer-left,
            .footer-center, 
            .footer-right {
                flex: 1;
            }
            
            .footer-left {
                text-align: left;
            }
            
            .footer-center {
                text-align: center;
                color: #d9241d;
                text-shadow: 2px 2px 4px rgba(175, 21, 21, 0.5); /* Adds a shadow to the text */
                font-size: 24px;
                font-weight: bold;
            }
            
            .footer-right {
                text-align: right;
                font-size: 18px;
                color: #1c1b1b;
            }
            
            .footer-logo {
                height: 20px;
            }
            .profile-container {
                margin-left: auto;
                padding-left: 20px;
            }
  </style>
</head>

<body>
  <div class="navbar">
    <!-- Logo Image (Before Home) -->
    <img src="../static/images/eicher_logo.png" alt="Eicher Logo" />
    <!-- <a href="{{ url_for('home') }}" style="color: white; font-size: 20px; font-weight: bold; text-decoration: none;">Valid Ops Centre</a> -->
    <!-- Home Icon -->
    <a href="{{ url_for('home') }}"><i class="fas fa-home"></i> Home</a>
    
    <!-- Our Service Dropdown -->
    
        <!-- <a href="#" ><i class="fas fa-cogs" ></i> Our Service</a> -->
       
   
    <a href="{{ url_for('dtc') }}"><i class="fas fa-chart-line"></i> DTC</a>
    
    <a href="{{ url_for('protus') }}"><i class="fas fa-briefcase"></i> Protus Management</a>

    <a href="{{ url_for('analytics') }}"><i class="fas fa-chart-bar"></i> Analytics</a>
    <!-- <a href="./protus.html"><i class="fas fa-briefcase"></i> Protus Management</a> -->
    <a class="tooltip" data-tooltip="Coming Soon...">
        <i class="fas fa-tachometer-alt"></i> Eff. Improvement
      </a>
      <a class="tooltip" data-tooltip="Coming Soon...">
        <i class="fas fa-cubes"></i> Comp./Agg. life
      </a>
      <a class="tooltip" data-tooltip="Coming Soon...">
        <i class="fas fa-tools"></i> Enhancement
      </a>
      <style>
        /* Basic styling */

/* Tooltip appearance */
.tooltip:hover::after {
  content: attr(data-tooltip); /* Use the data-tooltip attribute */
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  padding: 5px 10px;
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 14px;
  border-radius: 5px;
  white-space: nowrap;
  z-index: 10;
}
      </style>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" placeholder="Search...">
        <button><i class="fas fa-search"></i></button>
    </div>
    
    <!-- Profile Icon (Aligned to the right) -->
    <div class="profile-container">
        <a href="#"><i class="fas fa-user"></i> Profile</a>
    </div>
</div>
  
<!-- <div>
    <h3 class="protus-tracking">DTC Tracking</h3>
    <table class="table table-bordered">
        <thead id="myTable">
            <tr>
                <th>#</th>
                {% if dtc_data %}
                    {% for col_name in dtc_data[0].keys() %}
                    <th>{{ col_name }}</th>
                    {% endfor %}
                    <th>Actions</th>
                {% else %}
                    <th>No Data Available</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% if dtc_data %}
                {% for index, row in enumerate(dtc_data) %}
                <tr>
                    <td>{{ index + 1 }}</td>
                    {% for cell in row.values() %}
                    <td>{{ cell }}</td>
                    {% endfor %}
                    <td>
                        <form action="/raise/{{ index }}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-success btn-sm">Raise</button>
                        </form>
                        <form action="/delete/{{ index }}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="100%">No data available in DTC List</td>
                </tr>
            {% endif %}
            
        </tbody>
    </table>
</div> -->

<div>
    <h3 class="protus-tracking">Protus Tracking</h3>
    <table id="myTable">
        <thead>
            <tr>
                <th>#</th>
                {% if protus_data %}
                    {% for col_name in protus_data[0].keys() %}
                    {% if col_name != "Sr no" %}
                        <th>{{ col_name }}</th>
                    {% endif %}
                    {% endfor %}
                    <th>Report</th>
                {% else %}
                    <th>No Data Available</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% if dtc_data %}
                {% for index, row in enumerate(protus_data) %}
                <tr>
                    <td>{{ index + 1 }}</td>
                    {% for cell in row.values() %}
                    {% if loop.index > 1 %}
                    <td>
                        {% if cell != "Not available" %}
                            {% if loop.index in [7, 8] %}
                                {{ cell.strftime('%d/%m/%Y') }}
                            {% else %}
                                {{ cell }}
                            {% endif %}
                        {% endif %}
                    </td>
                    {% endif %}
                    {% endfor %}
                    {%print(row.values()[5])%}
                    <td><button id={{index}} disabled>View</button></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="100%">No data available in Protus List</td>
                </tr>
            {% endif %}
            
        </tbody>
    </table>
  </div>


  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>

const table = document.getElementById("myTable")
const rows = table.getElementsByTagName("tr");

for (let i = 1; i < rows.length; i++) {
    const cells = rows[i].getElementsByTagName("td");

    if (cells[5].innerText.trim().toLowerCase().includes("closed")) { 
        button = document.getElementById(i - 1);
        button.disabled = false;
        rows[i].classList.add("highlight"); 
    }
}


for (let i = 1; i < rows.length; i++) {
    const cells = rows[i].getElementsByTagName("td");

    if (cells[5].innerText.trim().toLowerCase().includes("closed")) { 
        const button = cells[13].querySelector('button');

        if (button && !button.disabled) {
            button.addEventListener('click', () => {
                const filename = cells[10]?.innerText.trim();

                if (!filename) {
                    alert("Filename is missing.");
                    return;
                }

                console.log('Attempting to download file:', filename);

                // Send POST request to Flask backend to download the file
                axios({
                    method: 'POST',
                    url: '/download',
                    headers: { 'Content-Type': 'application/json' },
                    data: JSON.stringify({ filename }),
                    responseType: 'blob'  // Handle the response as a binary file
                })
                .then(response => {
                    // Create a link element to trigger the download
                    const url = window.URL.createObjectURL(new Blob([response.data]));
                    const link = document.createElement('a');
                    link.href = url;
                    link.setAttribute('download', `${filename}.pptx`);
                    document.body.appendChild(link);
                    link.click();

                    // Clean up
                    setTimeout(() => {
                        link.parentNode.removeChild(link);
                        window.URL.revokeObjectURL(url);
                    }, 100);
                })
                .catch(error => {
                    console.error("Download Error:", error);
                    alert("Failed to download the file. Please try again.");
                });
            });
        }
    }
}


  </script>

<footer class="footer">
  <div class="footer-left">
      <img src="../static/images/ve-logo.jpg" alt="VE Logo" class="footer-logo">
  </div>
  <div class="footer-center">
      <a href="#"><marquee>Validation Operation Command Centre</marquee></a>
  </div>
  <div class="footer-right">
      Â© 2024 Eicher. All rights reserved.
  </div>
  </footer>
</body>

</html>